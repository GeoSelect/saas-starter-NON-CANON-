# Workspace Feature - Architecture & Data Flow

## ðŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT LAYER (Next.js App)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              React Components                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â€¢ WorkspaceDashboard    (Charts, Stats, Activity)       â”‚   â”‚
â”‚  â”‚  â€¢ ReportsList           (CRUD, Download, Share)         â”‚   â”‚
â”‚  â”‚  â€¢ MembersManager        (Invite, Roles, Remove)         â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Client Libraries                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â€¢ workspace-client.ts   (Workspace Management)           â”‚   â”‚
â”‚  â”‚  â€¢ activity-logger.ts    (Activity Tracking)             â”‚   â”‚
â”‚  â”‚  â€¢ report-client.ts      (Report Management)            â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                       HTTP Requests
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API LAYER (Node.js Backend)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Workspace Routes  â”‚  â”‚  Activity Routes   â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ POST   /           â”‚  â”‚ GET    /logs       â”‚                 â”‚
â”‚  â”‚ GET    /           â”‚  â”‚ POST   /logs       â”‚                 â”‚
â”‚  â”‚ GET    /:id        â”‚  â”‚ GET    /stats      â”‚                 â”‚
â”‚  â”‚ PATCH  /:id        â”‚  â”‚                    â”‚                 â”‚
â”‚  â”‚ DELETE /:id        â”‚  â”‚                    â”‚                 â”‚
â”‚  â”‚ POST   /:id/invite â”‚  â”‚                    â”‚                 â”‚
â”‚  â”‚ PATCH  /:id/membersâ”‚  â”‚                    â”‚                 â”‚
â”‚  â”‚ DELETE /:id/membersâ”‚  â”‚                    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Report Routes                               â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  POST   /                 (Create Report)                â”‚   â”‚
â”‚  â”‚  GET    /                 (List Reports)                 â”‚   â”‚
â”‚  â”‚  GET    /:id              (Get Report)                   â”‚   â”‚
â”‚  â”‚  PATCH  /:id              (Update Report)                â”‚   â”‚
â”‚  â”‚  DELETE /:id              (Delete Report)                â”‚   â”‚
â”‚  â”‚  POST   /:id/share        (Share Report)                 â”‚   â”‚
â”‚  â”‚  GET    /shared/:token    (Public Download)              â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                       SQL Queries
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATABASE LAYER (PostgreSQL)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  workspaces      â”‚  â”‚  activity_logs   â”‚                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
â”‚  â”‚ id (PK)          â”‚  â”‚ id (PK)          â”‚                     â”‚
â”‚  â”‚ name             â”‚  â”‚ workspace_id (FK)â”‚                     â”‚
â”‚  â”‚ slug (UNIQUE)    â”‚  â”‚ user_id (FK)     â”‚                     â”‚
â”‚  â”‚ description      â”‚  â”‚ action_type      â”‚                     â”‚
â”‚  â”‚ owner_id (FK)    â”‚  â”‚ action_desc      â”‚                     â”‚
â”‚  â”‚ plan_id          â”‚  â”‚ metadata (JSONB) â”‚                     â”‚
â”‚  â”‚ created_at       â”‚  â”‚ ip_address       â”‚                     â”‚
â”‚  â”‚ updated_at       â”‚  â”‚ user_agent       â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ created_at       â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚           â–²                      â–²                                â”‚
â”‚           â”‚                      â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                    (1:Many)                                       â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚users_workspaces  â”‚  â”‚    reports       â”‚                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
â”‚  â”‚ id (PK)          â”‚  â”‚ id (PK)          â”‚                     â”‚
â”‚  â”‚ user_id (FK)     â”‚  â”‚ workspace_id (FK)â”‚                     â”‚
â”‚  â”‚ workspace_id (FK)â”‚  â”‚ created_by (FK)  â”‚                     â”‚
â”‚  â”‚ role             â”‚  â”‚ title            â”‚                     â”‚
â”‚  â”‚ joined_at        â”‚  â”‚ description      â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ report_type      â”‚                     â”‚
â”‚  â”‚ UNIQUE(u_id,w_id)â”‚  â”‚ file_url         â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ file_format      â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ data_json (JSONB)â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ is_public        â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ created_at       â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚ updated_at       â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚           â–²                      â”‚                                â”‚
â”‚           â”‚                      â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                    (1:Many)                                       â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         shared_reports (Report Sharing)                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ id (PK)                                                   â”‚   â”‚
â”‚  â”‚ report_id (FK) â”€â”€â”€â”€â”€â”                                    â”‚   â”‚
â”‚  â”‚ share_token (UNIQUE)â”‚                                    â”‚   â”‚
â”‚  â”‚ shared_by (FK)      â”‚                                    â”‚   â”‚
â”‚  â”‚ password_hash       â”‚                                    â”‚   â”‚
â”‚  â”‚ expires_at          â”‚                                    â”‚   â”‚
â”‚  â”‚ max_downloads       â”‚                                    â”‚   â”‚
â”‚  â”‚ download_count      â”‚                                    â”‚   â”‚
â”‚  â”‚ is_active           â”‚                                    â”‚   â”‚
â”‚  â”‚ created_at          â”‚                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â–²                                       â”‚
â”‚                           â”‚                                       â”‚
â”‚                  (1:Many via report_id)                          â”‚
â”‚                                                                   â”‚
â”‚  â€¢ All tables have RLS enabled                                   â”‚
â”‚  â€¢ Foreign keys cascade on delete                                â”‚
â”‚  â€¢ Indexes on frequently queried columns                         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“Š Data Flow Diagrams

### 1. User Sign-Up & Workspace Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User Signs Up                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚   [Sign Up Page] â”€â”€> [Supabase Auth] â”€â”€> [Create User]          â”‚
â”‚                                               â”‚                   â”‚
â”‚                                               â–¼                   â”‚
â”‚                                    [Redirect to Workspace Page]   â”‚
â”‚                                               â”‚                   â”‚
â”‚                                               â–¼                   â”‚
â”‚                                    [User enters Workspace Name]   â”‚
â”‚                                               â”‚                   â”‚
â”‚                                               â–¼                   â”‚
â”‚   [Create Workspace]                                              â”‚
â”‚   â€¢ POST /api/workspaces                                         â”‚
â”‚   â€¢ { name, slug, description }                                  â”‚
â”‚                                               â”‚                   â”‚
â”‚                                               â–¼                   â”‚
â”‚   [Create user_workspace record]                                  â”‚
â”‚   â€¢ role = 'owner'                                               â”‚
â”‚                                               â”‚                   â”‚
â”‚                                               â–¼                   â”‚
â”‚   [Log Activity: 'workspace_created']                            â”‚
â”‚                                               â”‚                   â”‚
â”‚                                               â–¼                   â”‚
â”‚   [Redirect to /workspace/[id]]               â”‚                   â”‚
â”‚   [Display Dashboard] <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Activity Logging Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Action Occurs                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [User Action]  (e.g., Create Report, Share Report, Login)      â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Client/Server captures:]                                       â”‚
â”‚  â€¢ action_type                                                   â”‚
â”‚  â€¢ action_description                                            â”‚
â”‚  â€¢ metadata (additional context)                                 â”‚
â”‚  â€¢ IP address (from request header)                              â”‚
â”‚  â€¢ User agent (from request header)                              â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [POST /api/activity-logs]                                       â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Database: INSERT into activity_logs]                           â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Dashboard refreshes]                                           â”‚
â”‚  â€¢ Pie Chart updates                                             â”‚
â”‚  â€¢ Activity Feed updates                                         â”‚
â”‚  â€¢ Stats may update                                              â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [User sees live activity]                                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Report Generation & Sharing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate and Share Report                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [Workspace Member]                                              â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Generate Report]                                               â”‚
â”‚  â€¢ POST /api/reports                                             â”‚
â”‚  â€¢ { title, description, data, type }                            â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Insert into reports table]                                     â”‚
â”‚  â€¢ workspace_id                                                  â”‚
â”‚  â€¢ created_by (member's user_id)                                 â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Log Activity: 'report_created']                                â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Click "Share Report" Button]                                   â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [POST /api/reports/:id/share]                                   â”‚
â”‚  â€¢ { password?, expires_in_days?, max_downloads? }               â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Generate unique share_token]                                   â”‚
â”‚  â€¢ 64-character hex string                                       â”‚
â”‚  â€¢ Hash password if provided                                     â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Insert into shared_reports table]                              â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Log Activity: 'report_shared']                                 â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Display Share Link]                                            â”‚
â”‚  â€¢ https://domain.com/reports/shared/[token]                     â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Member copies link & sends to recipient]                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Public Report Access Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Public User Accesses Shared Report                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [Public User]                                                    â”‚
â”‚  (No login required)                                              â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Click Share Link]                                              â”‚
â”‚  /reports/shared/[token]                                         â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Frontend checks requirements]                                  â”‚
â”‚  â€¢ Token is valid?                                               â”‚
â”‚  â€¢ Link expired?                                                 â”‚
â”‚  â€¢ Download limit reached?                                       â”‚
â”‚  â€¢ Password protected?                                           â”‚
â”‚      â”‚                                                             â”‚
â”‚      â”œâ”€ YES (needs password)                                      â”‚
â”‚      â”‚   â”‚                                                         â”‚
â”‚      â”‚   â–¼                                                         â”‚
â”‚      â”‚  [Show password prompt]                                    â”‚
â”‚      â”‚   â”‚                                                         â”‚
â”‚      â”‚   â–¼                                                         â”‚
â”‚      â”‚  [User enters password]                                    â”‚
â”‚      â”‚   â”‚                                                         â”‚
â”‚      â”‚   â–¼                                                         â”‚
â”‚      â”‚  [GET /api/reports/shared/:token?password=...]            â”‚
â”‚      â”‚   â”‚                                                         â”‚
â”‚      â””â”€â”€â”€â”˜                                                        â”‚
â”‚          â”‚                                                         â”‚
â”‚      NO (no password needed)                                      â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [GET /api/reports/shared/:token]                                â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Validate shared_reports entry]                                 â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Increment download_count]                                      â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Log Activity: 'report_downloaded']                              â”‚
â”‚  â€¢ Track IP address                                              â”‚
â”‚  â€¢ Track user agent                                              â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Return report data]                                            â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [User downloads PDF/CSV]                                        â”‚
â”‚      â”‚                                                             â”‚
â”‚      â–¼                                                             â”‚
â”‚  [Activity logged for audit trail]                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Workspace Membership & Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workspace Membership Hierarchy                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Workspace Owner (auto-assigned)                                 â”‚
â”‚  â”œâ”€ Can do everything                                            â”‚
â”‚  â”œâ”€ Delete workspace                                             â”‚
â”‚  â”œâ”€ Manage all members                                           â”‚
â”‚  â”œâ”€ Create/edit/delete reports                                   â”‚
â”‚  â”œâ”€ View all activity logs                                       â”‚
â”‚  â””â”€ Create and share reports                                     â”‚
â”‚                                                                   â”‚
â”‚  Admin (assigned by owner)                                       â”‚
â”‚  â”œâ”€ Manage members                                               â”‚
â”‚  â”œâ”€ Create/edit/delete reports                                   â”‚
â”‚  â”œâ”€ View all activity logs                                       â”‚
â”‚  â””â”€ Create and share reports                                     â”‚
â”‚                                                                   â”‚
â”‚  Member (default when invited)                                   â”‚
â”‚  â”œâ”€ Create reports                                               â”‚
â”‚  â”œâ”€ Share reports                                                â”‚
â”‚  â”œâ”€ View activity logs                                           â”‚
â”‚  â”œâ”€ View workspace data                                          â”‚
â”‚  â””â”€ Cannot manage members                                        â”‚
â”‚                                                                   â”‚
â”‚  Viewer (read-only)                                              â”‚
â”‚  â”œâ”€ View workspace data                                          â”‚
â”‚  â”œâ”€ View reports                                                 â”‚
â”‚  â”œâ”€ View activity logs                                           â”‚
â”‚  â””â”€ Cannot create/edit/delete/share                              â”‚
â”‚                                                                   â”‚
â”‚  Public User (via shared link)                                   â”‚
â”‚  â”œâ”€ View specific shared report                                  â”‚
â”‚  â”œâ”€ Download specific report                                     â”‚
â”‚  â””â”€ Cannot access workspace                                      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ State Management

```
Client State:
â”œâ”€â”€ Workspace (currently selected)
â”œâ”€â”€ Members (list of workspace members)
â”œâ”€â”€ Reports (list of workspace reports)
â”œâ”€â”€ ActivityLogs (recent activity)
â”œâ”€â”€ Stats (workspace statistics)
â””â”€â”€ UI State (loading, errors, modals)

Database State:
â”œâ”€â”€ workspaces
â”œâ”€â”€ users_workspaces
â”œâ”€â”€ activity_logs
â”œâ”€â”€ reports
â””â”€â”€ shared_reports
```

## ðŸ” Security Layers

```
Layer 1: Authentication (Supabase Auth)
â”œâ”€ JWT tokens
â”œâ”€ Session management
â””â”€ User verification

Layer 2: API Authorization
â”œâ”€ Check user_id matches request
â”œâ”€ Verify workspace membership
â”œâ”€ Check role permissions
â””â”€ Validate ownership

Layer 3: Database RLS
â”œâ”€ Row level policies
â”œâ”€ User-based access control
â”œâ”€ Automatic query filtering
â””â”€ Data isolation

Layer 4: Data Protection
â”œâ”€ Password hashing (bcrypt)
â”œâ”€ Unique tokens
â”œâ”€ Expiration dates
â”œâ”€ Download limits
â””â”€ IP logging
```

## ðŸ“ˆ Scaling Considerations

```
Current Implementation:
â”œâ”€ Single workspace per user (initial setup)
â”œâ”€ Unlimited team members
â”œâ”€ Unlimited reports
â”œâ”€ Full activity history
â””â”€ Supports multiple workspaces per user

Optimization Opportunities:
â”œâ”€ Add pagination to activity logs
â”œâ”€ Archive old activity logs
â”œâ”€ Cache workspace stats
â”œâ”€ Index on created_at for sorting
â”œâ”€ Compress large reports
â””â”€ Archive reports to object storage
```

## ðŸš€ Deployment Checklist

```
Pre-Deployment:
âœ… Database migration tested
âœ… All API endpoints tested
âœ… RLS policies verified
âœ… Environment variables set
âœ… SSL certificates configured

Deployment:
âœ… Run database migration
âœ… Deploy API code
âœ… Deploy Next.js frontend
âœ… Verify RLS is enabled
âœ… Test all endpoints

Post-Deployment:
âœ… Monitor error logs
âœ… Check API response times
âœ… Verify database connections
âœ… Test RLS enforcement
âœ… Monitor activity logs
```

This architecture is production-ready and scalable!
